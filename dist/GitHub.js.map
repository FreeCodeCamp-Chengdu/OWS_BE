{"version":3,"sources":["../source/GitHub.js"],"names":["OAuth","client_id","client_secret","onDone","context","response","method","body","URLSearchParams","code","query","errorHandler","Object","fromEntries","text","entries","scope","split","headers","Authorization","access_token","Accept","user","json"],"mappings":";;;;;;;AAAA;;AAEA;;AAEO,SAASA,KAAT,CAAeC,SAAf,EAA0BC,aAA1B,EAAyCC,MAAzC,EAAiD;AACpD,SAAO,MAAMC,OAAN,IAAiB;AACpB,QAAIC,QAAQ,GAAG,MAAM,sBACjB,6CADiB,EAEjB;AACIC,MAAAA,MAAM,EAAE,MADZ;AAEIC,MAAAA,IAAI,EAAE,IAAIC,oBAAJ,CAAoB;AACtBP,QAAAA,SADsB;AAEtBC,QAAAA,aAFsB;AAGtBO,QAAAA,IAAI,EAAEL,OAAO,CAACM,KAAR,CAAcD;AAHE,OAApB,CAFV;AAOIE,MAAAA,YAAY,EAAZA;AAPJ,KAFiB,CAArB;AAaA,UAAMJ,IAAI,GAAGK,MAAM,CAACC,WAAP,CACT,IAAIL,oBAAJ,EAAoB,MAAMH,QAAQ,CAACS,IAAT,EAA1B,GAA2CC,OAA3C,EADS,CAAb;AAIA,QAAIR,IAAI,CAACS,KAAT,EAAgBT,IAAI,CAACS,KAAL,GAAaT,IAAI,CAACS,KAAL,CAAWC,KAAX,CAAiB,GAAjB,CAAb;AAEhBZ,IAAAA,QAAQ,GAAG,MAAM,sBAAQ,6BAAR,EAAuC;AACpDa,MAAAA,OAAO,EAAE;AACLC,QAAAA,aAAa,EAAG,SAAQZ,IAAI,CAACa,YAAa,EADrC;AAELC,QAAAA,MAAM,EAAE;AAFH,OAD2C;AAKpDV,MAAAA,YAAY,EAAZA;AALoD,KAAvC,CAAjB;AAQAJ,IAAAA,IAAI,CAACe,IAAL,GAAY,MAAMjB,QAAQ,CAACkB,IAAT,EAAlB;AAEA,UAAMpB,MAAM,CAACC,OAAD,EAAUG,IAAV,CAAZ;AACH,GA/BD;AAgCH","sourcesContent":["import { URLSearchParams } from 'url';\n\nimport { request, errorHandler } from './utility';\n\nexport function OAuth(client_id, client_secret, onDone) {\n    return async context => {\n        var response = await request(\n            'https://github.com/login/oauth/access_token',\n            {\n                method: 'POST',\n                body: new URLSearchParams({\n                    client_id,\n                    client_secret,\n                    code: context.query.code\n                }),\n                errorHandler\n            }\n        );\n\n        const body = Object.fromEntries(\n            new URLSearchParams(await response.text()).entries()\n        );\n\n        if (body.scope) body.scope = body.scope.split(',');\n\n        response = await request('https://api.github.com/user', {\n            headers: {\n                Authorization: `token ${body.access_token}`,\n                Accept: 'application/json'\n            },\n            errorHandler\n        });\n\n        body.user = await response.json();\n\n        await onDone(context, body);\n    };\n}\n"],"file":"GitHub.js"}