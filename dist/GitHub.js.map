{"version":3,"sources":["../source/GitHub.js"],"names":["OAuth","client_id","client_secret","onDone","context","code","state","query","response","method","body","URLSearchParams","errorHandler","Object","fromEntries","text","entries","scope","split","headers","Authorization","access_token","Accept","user","json"],"mappings":";;;;;;;AAAA;;AAEA;;AAEO,SAASA,KAAT,CAAeC,SAAf,EAA0BC,aAA1B,EAAyCC,MAAzC,EAAiD;AACpD,SAAO,MAAMC,OAAN,IAAiB;AACpB,UAAM;AAAEC,MAAAA,IAAF;AAAQC,MAAAA;AAAR,QAAkBF,OAAO,CAACG,KAAhC;AAEA,QAAIC,QAAQ,GAAG,MAAM,sBACjB,6CADiB,EAEjB;AACIC,MAAAA,MAAM,EAAE,MADZ;AAEIC,MAAAA,IAAI,EAAE,IAAIC,oBAAJ,CAAoB;AACtBV,QAAAA,SADsB;AAEtBC,QAAAA,aAFsB;AAGtBG,QAAAA,IAHsB;AAItBC,QAAAA;AAJsB,OAApB,CAFV;AAQIM,MAAAA,YAAY,EAAZA;AARJ,KAFiB,CAArB;AAcA,UAAMF,IAAI,GAAGG,MAAM,CAACC,WAAP,CACT,IAAIH,oBAAJ,EAAoB,MAAMH,QAAQ,CAACO,IAAT,EAA1B,GAA2CC,OAA3C,EADS,CAAb;AAIA,QAAIN,IAAI,CAACO,KAAT,EAAgBP,IAAI,CAACO,KAAL,GAAaP,IAAI,CAACO,KAAL,CAAWC,KAAX,CAAiB,GAAjB,CAAb;AAEhBV,IAAAA,QAAQ,GAAG,MAAM,sBAAQ,6BAAR,EAAuC;AACpDW,MAAAA,OAAO,EAAE;AACLC,QAAAA,aAAa,EAAG,SAAQV,IAAI,CAACW,YAAa,EADrC;AAELC,QAAAA,MAAM,EAAE;AAFH,OAD2C;AAKpDV,MAAAA,YAAY,EAAZA;AALoD,KAAvC,CAAjB;AAQAF,IAAAA,IAAI,CAACa,IAAL,GAAY,MAAMf,QAAQ,CAACgB,IAAT,EAAlB;AAEA,UAAMrB,MAAM,CAACC,OAAD,EAAUM,IAAV,EAAgBJ,KAAhB,CAAZ;AACH,GAlCD;AAmCH","sourcesContent":["import { URLSearchParams } from 'url';\n\nimport { request, errorHandler } from './utility';\n\nexport function OAuth(client_id, client_secret, onDone) {\n    return async context => {\n        const { code, state } = context.query;\n\n        var response = await request(\n            'https://github.com/login/oauth/access_token',\n            {\n                method: 'POST',\n                body: new URLSearchParams({\n                    client_id,\n                    client_secret,\n                    code,\n                    state\n                }),\n                errorHandler\n            }\n        );\n\n        const body = Object.fromEntries(\n            new URLSearchParams(await response.text()).entries()\n        );\n\n        if (body.scope) body.scope = body.scope.split(',');\n\n        response = await request('https://api.github.com/user', {\n            headers: {\n                Authorization: `token ${body.access_token}`,\n                Accept: 'application/json'\n            },\n            errorHandler\n        });\n\n        body.user = await response.json();\n\n        await onDone(context, body, state);\n    };\n}\n"],"file":"GitHub.js"}