{"version":3,"sources":["../source/session.js"],"names":["GITHUB_APP_ID","GITHUB_APP_SECRET","process","env","entry","context","body","currentUser","get","GitHub","user","User","loginWithAuthData","access_token","expires_in","uid","id","scope","saveCurrentUser","save","username","login","email","github","redirect"],"mappings":";;;;;;;;AAAA;;AAEA;;AAEA,MAAM;AAAEA,EAAAA,aAAF;AAAiBC,EAAAA;AAAjB,IAAuCC,OAAO,CAACC,GAArD;;AAEO,SAASC,KAAT,CAAeC,OAAf,EAAwB;AAC3BA,EAAAA,OAAO,CAACC,IAAR,GAAgB;aAEhBD,OAAO,CAACE,WAAR,GAAsBF,OAAO,CAACE,WAAR,CAAoBC,GAApB,CAAwB,UAAxB,CAAtB,GAA4D,SAC/D;8DAC6DR,aAAc;;KAJxE;AAOH;;AAEM,MAAMS,MAAM,GAAG,mBAClBT,aADkB,EAElBC,iBAFkB,EAGlB,OAAOI,OAAP,EAAgBC,IAAhB,KAAyB;AACrB,QAAMI,IAAI,GAAG,MAAMC,iBAAKC,iBAAL,CACf;AACIC,IAAAA,YAAY,EAAEP,IAAI,CAACO,YADvB;AAEIC,IAAAA,UAAU,EAAE,IAFhB;AAGIC,IAAAA,GAAG,EAAET,IAAI,CAACI,IAAL,CAAUM,EAAV,GAAe,EAHxB;AAIIC,IAAAA,KAAK,EAAEX,IAAI,CAACW,KAAL,GAAa;AAJxB,GADe,EAOf,QAPe,CAAnB;AAUAZ,EAAAA,OAAO,CAACa,eAAR,CAAwBR,IAAxB;AAEA,QAAMA,IAAI,CAACS,IAAL,CACF;AACIC,IAAAA,QAAQ,EAAEd,IAAI,CAACI,IAAL,CAAUW,KADxB;AAEIC,IAAAA,KAAK,EAAEhB,IAAI,CAACI,IAAL,CAAUY,KAFrB;AAGIC,IAAAA,MAAM,EAAEjB,IAAI,CAACI;AAHjB,GADE,EAMF;AAAEA,IAAAA;AAAF,GANE,CAAN;AASAL,EAAAA,OAAO,CAACmB,QAAR,CAAiB,aAAalB,IAAI,CAACO,YAAnC;AACH,CA1BiB,CAAf","sourcesContent":["import { User } from 'leanengine';\n\nimport { OAuth } from './GitHub';\n\nconst { GITHUB_APP_ID, GITHUB_APP_SECRET } = process.env;\n\nexport function entry(context) {\n    context.body = `\n<h1>Hello, ${\n    context.currentUser ? context.currentUser.get('username') : 'FCC-CDC'\n}!</h1>\n<a href=\"https://github.com/login/oauth/authorize?client_id=${GITHUB_APP_ID}&scope=user,repo\">\nSign in\n</a>`;\n}\n\nexport const GitHub = OAuth(\n    GITHUB_APP_ID,\n    GITHUB_APP_SECRET,\n    async (context, body) => {\n        const user = await User.loginWithAuthData(\n            {\n                access_token: body.access_token,\n                expires_in: 7200,\n                uid: body.user.id + '',\n                scope: body.scope + ''\n            },\n            'github'\n        );\n\n        context.saveCurrentUser(user);\n\n        await user.save(\n            {\n                username: body.user.login,\n                email: body.user.email,\n                github: body.user\n            },\n            { user }\n        );\n\n        context.redirect('/?token=' + body.access_token);\n    }\n);\n"],"file":"session.js"}