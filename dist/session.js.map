{"version":3,"sources":["../source/session.js"],"names":["GITHUB_APP_ID","GITHUB_APP_SECRET","process","env","entry","context","currentUser","fetch","body","get","GitHub","user","User","loginWithAuthData","access_token","expires_in","uid","id","scope","saveCurrentUser","save","username","login","email","github","redirect"],"mappings":";;;;;;;;AAAA;;AAEA;;AAEA,MAAM;AAAEA,EAAAA,aAAF;AAAiBC,EAAAA;AAAjB,IAAuCC,OAAO,CAACC,GAArD;;AAEO,eAAeC,KAAf,CAAqBC,OAArB,EAA8B;AACjC,QAAM;AAAEC,IAAAA;AAAF,MAAkBD,OAAxB;AAEA,MAAIC,WAAJ,EAAiB,MAAMA,WAAW,CAACC,KAAZ,EAAN;AAEjBF,EAAAA,OAAO,CAACG,IAAR,GAAgB;aACPF,WAAW,GAAGA,WAAW,CAACG,GAAZ,CAAgB,UAAhB,CAAH,GAAiC,SAAU;8DACLT,aAAc;;KAFxE;AAKH;;AAEM,MAAMU,MAAM,GAAG,mBAClBV,aADkB,EAElBC,iBAFkB,EAGlB,OAAOI,OAAP,EAAgBG,IAAhB,KAAyB;AACrB,QAAMG,IAAI,GAAG,MAAMC,iBAAKC,iBAAL,CACf;AACIC,IAAAA,YAAY,EAAEN,IAAI,CAACM,YADvB;AAEIC,IAAAA,UAAU,EAAE,IAFhB;AAGIC,IAAAA,GAAG,EAAER,IAAI,CAACG,IAAL,CAAUM,EAAV,GAAe,EAHxB;AAIIC,IAAAA,KAAK,EAAEV,IAAI,CAACU,KAAL,GAAa;AAJxB,GADe,EAOf,QAPe,CAAnB;AAUAb,EAAAA,OAAO,CAACc,eAAR,CAAwBR,IAAxB;AAEA,QAAMA,IAAI,CAACS,IAAL,CACF;AACIC,IAAAA,QAAQ,EAAEb,IAAI,CAACG,IAAL,CAAUW,KADxB;AAEIC,IAAAA,KAAK,EAAEf,IAAI,CAACG,IAAL,CAAUY,KAFrB;AAGIC,IAAAA,MAAM,EAAEhB,IAAI,CAACG;AAHjB,GADE,EAMF;AAAEA,IAAAA;AAAF,GANE,CAAN;AASAN,EAAAA,OAAO,CAACoB,QAAR,CAAiB,aAAajB,IAAI,CAACM,YAAnC;AACH,CA1BiB,CAAf","sourcesContent":["import { User } from 'leanengine';\n\nimport { OAuth } from './GitHub';\n\nconst { GITHUB_APP_ID, GITHUB_APP_SECRET } = process.env;\n\nexport async function entry(context) {\n    const { currentUser } = context;\n\n    if (currentUser) await currentUser.fetch();\n\n    context.body = `\n<h1>Hello, ${currentUser ? currentUser.get('username') : 'FCC-CDC'}!</h1>\n<a href=\"https://github.com/login/oauth/authorize?client_id=${GITHUB_APP_ID}&scope=user,repo\">\nSign in\n</a>`;\n}\n\nexport const GitHub = OAuth(\n    GITHUB_APP_ID,\n    GITHUB_APP_SECRET,\n    async (context, body) => {\n        const user = await User.loginWithAuthData(\n            {\n                access_token: body.access_token,\n                expires_in: 7200,\n                uid: body.user.id + '',\n                scope: body.scope + ''\n            },\n            'github'\n        );\n\n        context.saveCurrentUser(user);\n\n        await user.save(\n            {\n                username: body.user.login,\n                email: body.user.email,\n                github: body.user\n            },\n            { user }\n        );\n\n        context.redirect('/?token=' + body.access_token);\n    }\n);\n"],"file":"session.js"}