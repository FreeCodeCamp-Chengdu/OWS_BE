{"version":3,"sources":["../source/app.js"],"names":["app","Koa","use","Session","entry","context","query","source","currentUser","fetch","get","github","access_token","update","search","Form","create","searchForm","createReply","bind","queryReply","queryForm","queryStatistic","rule","RecurrenceRule","hour"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;AAEA;;AACA;;AACA;;AAEA;;AAEO,MAAMA,GAAG,GAAG,IAAIC,YAAJ,GACdC,GADc,CACV,mBAAI,GAAJ,EAASC,OAAO,CAACC,KAAjB,CADU,EAEdF,GAFc,CAEV,mBAAI,QAAJ,EAAcG,OAAO,IAAIF,OAAO,CAACE,OAAO,CAACC,KAAR,CAAcC,MAAf,CAAP,CAA8BF,OAA9B,CAAzB,CAFU,EAGdH,GAHc,CAIX,uBACI,SADJ,EAEI,IAAID,YAAJ,GAAUC,GAAV,CACI,6BACI,mBAAM,OAAO;AAAEM,EAAAA;AAAF,CAAP,KAA2B;AAC7B,QAAMA,WAAW,CAACC,KAAZ,EAAN;AAEA,SAAOD,WAAW,CAACE,GAAZ,CAAgB,UAAhB,EAA4BC,MAA5B,CAAmCC,YAA1C;AACH,CAJD,CADJ,CADJ,CAFJ,CAJW,EAiBdV,GAjBc,CAiBV,oBAAK,kBAAL,EAAyB,6BAAeW,gBAAf,CAAzB,CAjBU,EAkBdX,GAlBc,CAkBV,mBAAI,WAAJ,EAAiBY,gBAAjB,CAlBU,EAmBdZ,GAnBc,CAoBX,oBACI,OADJ,EAEI,6BAAeG,OAAO,IAClBU,IAAI,CAACV,OAAO,CAACC,KAAR,CAAcC,MAAf,CAAJ,CAA2BS,MAA3B,CAAkCX,OAAlC,CADJ,CAFJ,CApBW,EA2BdH,GA3Bc,CA2BV,mBAAI,OAAJ,EAAaa,IAAI,CAACE,UAAlB,CA3BU,EA4Bdf,GA5Bc,CA4BV,oBAAK,kBAAL,EAAyBa,IAAI,CAACG,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,EAA4BJ,IAA5B,CAAzB,CA5BU,EA6Bdb,GA7Bc,CA6BV,mBAAI,sBAAJ,EAA4Ba,IAAI,CAACK,UAAL,CAAgBD,IAAhB,CAAqB,IAArB,EAA2BJ,IAA3B,CAA5B,CA7BU,EA8Bdb,GA9Bc,CA8BV,mBAAI,WAAJ,EAAiBa,IAAI,CAACM,SAAL,CAAeF,IAAf,CAAoB,IAApB,EAA0BJ,IAA1B,CAAjB,CA9BU,EA+Bdb,GA/Bc,CA+BV,mBAAI,qBAAJ,EAA2Ba,IAAI,CAACO,cAAhC,CA/BU,CAAZ;;AAiCP,MAAMC,IAAI,GAAG,IAAIC,4BAAJ,EAAb;AAEAD,IAAI,CAACE,IAAL,GAAY,CAAZ;AAEA,+BAAYF,IAAZ,EAAkB,MAAM,sBAAO;AAAEjB,EAAAA,KAAK,EAAE;AAAT,CAAP,CAAxB","sourcesContent":["import Koa from 'koa';\nimport { get, post } from 'koa-route';\nimport mount from 'koa-mount';\n\nimport { requireSession } from './utility';\nimport { proxy } from './utility/GitHub';\n\nimport * as Session from './session';\nimport { update, search } from './activity';\nimport * as Form from './form';\n\nimport { scheduleJob, RecurrenceRule } from 'node-schedule';\n\nexport const app = new Koa()\n    .use(get('/', Session.entry))\n    .use(get('/OAuth', context => Session[context.query.source](context)))\n    .use(\n        mount(\n            '/github',\n            new Koa().use(\n                requireSession(\n                    proxy(async ({ currentUser }) => {\n                        await currentUser.fetch();\n\n                        return currentUser.get('authData').github.access_token;\n                    })\n                )\n            )\n        )\n    )\n    .use(post('/activity/update', requireSession(update)))\n    .use(get('/activity', search))\n    .use(\n        post(\n            '/form',\n            requireSession(context =>\n                Form[context.query.source].create(context)\n            )\n        )\n    )\n    .use(get('/form', Form.searchForm))\n    .use(post('/form/:OID/reply', Form.createReply.bind(null, Form)))\n    .use(get('/form/:fid/reply/:id', Form.queryReply.bind(null, Form)))\n    .use(get('/form/:id', Form.queryForm.bind(null, Form)))\n    .use(get('/form/:id/statistic', Form.queryStatistic));\n\nconst rule = new RecurrenceRule();\n\nrule.hour = 1;\n\nscheduleJob(rule, () => update({ query: {} }));\n"],"file":"app.js"}